#General
type Transaction @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type User @entity(immutable: false) {
  id: Bytes!
  email: String! # string
  username: String! # string
  fullName: String! # string
  accountId: BigInt! # uint256
  photo: String! # string
  lastPhotoUpdate: BigInt! # uint256
  createdAt: BigInt! # uint256
  hasProfile: Boolean! # bool
  repCategory: Int!
  totalReputation: BigInt! # uint256
  totalLatePayments: BigInt! # uint256
  totalCirclesCompleted: BigInt! # uint256
  totalGoalsCompleted: BigInt! # uint256
  personalGoals: [PersonalGoalCreated!]! @derivedFrom(field: "user")
  earlyWithdrawals: [GoalWithdrawn!]! @derivedFrom(field: "user")
  circlesCreated: [CircleCreated!]! @derivedFrom(field: "user")
  circlesJoined: [CircleJoined!]! @derivedFrom(field: "user")
  circlesCompleted: [CircleCompleted]! @derivedFrom(field: "user")
}

#User Profile
type ProfileCreated @entity(immutable: true) {
  id: Bytes!
  user: User!
  transaction: Transaction!
}

type PhotoUpdated @entity(immutable: true) {
  id: Bytes!
  user: User!
  transaction: Transaction!
}

#User Reputation
type LatePaymentRecorded @entity(immutable: true) {
  id: Bytes!
  user: User!
  circle: CircleStarted!
  round: BigInt! # uint256
  fee: BigInt! # uint256
  transaction: Transaction!
}

type CircleCompleted @entity(immutable: true) {
  id: Bytes!
  user: User!
  circle: CircleStarted!
  transaction: Transaction!
}

type GoalCompleted @entity(immutable: true) {
  id: Bytes!
  user: User!
  goal: PersonalGoalCreated!
  transaction: Transaction!
}

type ReputationDecreased @entity(immutable: false) {
  id: Bytes!
  user: User!
  points: BigInt! # uint256
  reason: String! # string
  transaction: Transaction!
}

type ReputationIncreased @entity(immutable: false) {
  id: Bytes!
  user: User!
  points: BigInt! # uint256
  reason: String! # string
  transaction: Transaction!
}

type ScoreCategoryChanged @entity(immutable: false) {
  id: Bytes!
  user: User!
  oldCategory: Int! 
  newCategory: Int! 
  transaction: Transaction!
}

#Personal Goal Savings
type PersonalGoalCreated @entity(immutable: true) {
  id: Bytes!
  user: User!
  goalId: BigInt! # uint256
  goalName: String! # string
  goalAmount: BigInt! # uint256
  currentAmount: BigInt! # uint256
  isActive: Boolean! # bool
  transaction: Transaction!
}

type GoalContribution @entity(immutable: true) {
  id: Bytes!
  user: User!
  amount: BigInt! # uint256
  goal: PersonalGoalCreated!
  transaction: Transaction!
}

type GoalWithdrawn @entity(immutable: true) {
  id: Bytes!
  user: User!
  goal: PersonalGoalCreated!
  amount: BigInt! # uint256
  penalty: BigInt! # uint256
  transaction: Transaction!
}

#Circle Savings
type CircleCreated @entity(immutable: false) {
  id: Bytes!
  user: User!
  circleId: BigInt! # uint256
  circleName: String! # string
  circleDescription: String! # string
  circleContributionAmount: BigInt! # uint256
  collateralAmount: BigInt! # uint256
  circleFrequency: Int! 
  circleMaxMembers: BigInt! # uint256
  circleVisibility: Int! 
  circleCreatedAt: BigInt! # uint256
  transaction: Transaction!
  circleMembers: [CircleJoined!]! @derivedFrom(field: "circle")
}

type CircleJoined @entity(immutable: false) {
  id: Bytes!
  circle: CircleCreated!
  user: User!
  currentMembers: BigInt! # uint256
  circleState: Int!
  transaction: Transaction!
}

type CircleStarted @entity(immutable: true) {
  id: Bytes!
  circle: CircleCreated!
  circleStartedAt: BigInt! # uint256
  transaction: Transaction!
}

type ContributionMade @entity(immutable: true) {
  id: Bytes!
  user: User!
  circle: CircleStarted!
  round: BigInt! # uint256
  amount: BigInt! # uint256
  transaction: Transaction!
}

type PositionAssigned @entity(immutable: false) {
  id: Bytes!
  user: User!
  circle: CircleCreated!
  position: BigInt! # uint256
  transaction: Transaction!
}

type MemberForfeited @entity(immutable: true) {
  id: Bytes!
  forfeiter: User!
  circle: CircleStarted!
  round: BigInt! # uint256
  deductionAmount: BigInt! # uint256
  forfeitedUser: User!
  transaction: Transaction!
}

type VisibilityUpdated @entity(immutable: true) {
  id: Bytes!
  circle: CircleCreated!
  transaction: Transaction!
}

type VotingInitiated @entity(immutable: true) {
  id: Bytes!
  circle: CircleCreated!
  votingStartAt: BigInt! # uint256
  votingEndAt: BigInt! # uint256
  transaction: Transaction!
}

type VoteCast @entity(immutable: true) {
  id: Bytes!
  voter: User!
  circle: CircleCreated!
  choice: Int! 
  transaction: Transaction!
}

type VoteExecuted @entity(immutable: true) {
  id: Bytes!
  circle: CircleCreated!
  circleStarted: Boolean! 
  StartVoteTotal: BigInt! # uint256
  withdrawVoteTotal: BigInt! # uint256
  transaction: Transaction!
}

type PayoutDistributed @entity(immutable: true) {
  id: Bytes!
  user: User!
  circle: CircleStarted!
  round: BigInt! # uint256
  payoutAmount: BigInt! # uint256
  transaction: Transaction!
}

type CollateralWithdrawn @entity(immutable: true) {
  id: Bytes!
  user: User!
  circle: CircleCreated!
  amount: BigInt! # uint256
  transaction: Transaction!
}

type MemberInvited @entity(immutable: true) {
  id: Bytes!
  inviter: User! 
  invitee: User! 
  circle: CircleCreated!
  invitedAt: BigInt!
  transaction: Transaction!
}

